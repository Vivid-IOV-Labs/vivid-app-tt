<!DOCTYPE html>
<html lang="eng">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <title>
    Peerkat.live Features Test
  </title>
  <meta name="description" content="Tests for ASM, WASM, HTTPS, WebGL, getUserMedia, and successful camera access">

</head>
<style>
  ul{-webkit-column-count: 3;-moz-column-count: 3;column-count: 3;}
  .supported{color: green;}
  .not-supported{color: red;}
</style>
<body>
  <div id="list-rendering">
    <h1>Peerkat.live Features Test</h1>
    <h3>Must</h3>
    <ul>
      <li :class="{ supported: feat.supported, 'not-supported': !feat.supported }" v-for="feat in must">
        {{ feat.text }} <span v-if="feat.supported ">&#10003;</span> <span v-else>&times;</span>
      </li>
    </ul>
    <h3>Nice To have</h3>
    <ul>
      <li :class="{ supported: feat.supported, 'not-supported': !feat.supported }" v-for="feat in nicetohave">
        {{ feat.text }} <span v-if="feat.supported ">&#10003;</span> <span v-else>&times;</span>
      </li>
    </ul>
    <hr>
    <div sltyle="display:flex">
      <button v-on:click="goToHTTPS">Force https</button>
      <button v-on:click="getGeolocation">GetPosition</button>

    </div>
    <hr>

  </div>
  <script src="./modernizr.js"></script>
  <script src="https://unpkg.com/vue@next"></script>
  <script>
    const testGetUserMedia = () =>{
        return navigator && navigator.mediaDevices && navigator.mediaDevices.getUserMedia;
    };
    const testWebSocket = () => {
     return !!window.WebSocket
    }
    const testGeolocation = () =>{
        return navigator && navigator.geolocation;
    };
    const testFacingMode = ()=> {
      const {facingMode} = navigator.mediaDevices.getSupportedConstraints() 
      return facingMode
    }
    const testHTTPS = ()=> {
            return (location.protocol === 'https:') ? true : false;
        };
        const captureAndInjectCameraFeed = (callback)=> {
            var video = document.createElement('video');
            video.width = 640;
            video.height = 480;
            video.setAttribute('autoplay', '');

            var constraints = {
                video: true,
                audio: false
            };

            function handleSuccess(stream) {
                window.stream = stream; // make stream available to browser console
                video.srcObject = stream;
                document.body.appendChild(video);
            }

            function handleError(error) {
                console.log('navigator.getUserMedia error: ', error);
            }

            navigator.mediaDevices.getUserMedia(constraints).
                then(handleSuccess).catch(handleError);
        };
        const getPosition = options => {
  return new Promise((resolve, reject) =>
    navigator.geolocation.getCurrentPosition(resolve, reject, options)
  );
};
    const ListRendering = {
      data() {
        return {
          must: [
          { text: 'https', supported: testHTTPS()},
          { text: 'geolocation', supported: Modernizr.geolocation },
          { text: 'touchevents', supported: Modernizr.touchevents },
          { text: 'websockets', supported: Modernizr.websockets },
          { text: 'getusermedia', supported: Modernizr.getusermedia },
          { text: 'peerconnection', supported: Modernizr.peerconnection },
          ],
          nicetohave:[
          { text: 'localstorage', supported: Modernizr.localstorage },
          { text: 'datachannel', supported: Modernizr.datachannel },
          { text: 'devicemotion', supported: Modernizr.devicemotion },
          { text: 'deviceorientation', supported: Modernizr.deviceorientation },
          { text: 'facingMode', supported: testFacingMode() },
          ]
        }
      },
      methods: {
        goToHTTPS() {
          debugger
            location.href = 'https:' + window.location.href.substring(window.location.protocol.length);
        },
        getGeolocation(){
          if(Modernizr.geolocation ){
            getPosition().then(console.log).catch(console.log);
          }
        }
      },
      mounted() {
        this.$nextTick(function () {
         captureAndInjectCameraFeed()
        })
      }
    }

    Vue.createApp(ListRendering).mount('#list-rendering')
  </script>
</body>

</html>