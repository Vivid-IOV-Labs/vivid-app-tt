(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["SupplyStream~ViewStream"],{2532:function(e,t,n){"use strict";var a=n("23e7"),o=n("5a34"),i=n("1d80"),r=n("ab13");a({target:"String",proto:!0,forced:!r("includes")},{includes:function(e){return!!~String(i(this)).indexOf(o(e),arguments.length>1?arguments[1]:void 0)}})},"44e7":function(e,t,n){var a=n("861d"),o=n("c6b6"),i=n("b622"),r=i("match");e.exports=function(e){var t;return a(e)&&(void 0!==(t=e[r])?!!t:"RegExp"==o(e))}},"5a34":function(e,t,n){var a=n("44e7");e.exports=function(e){if(a(e))throw TypeError("The method doesn't accept regular expressions");return e}},a434:function(e,t,n){"use strict";var a=n("23e7"),o=n("23cb"),i=n("a691"),r=n("50c4"),c=n("7b0b"),d=n("65f0"),s=n("8418"),l=n("1dde"),m=n("ae40"),u=l("splice"),f=m("splice",{ACCESSORS:!0,0:0,1:2}),p=Math.max,h=Math.min,g=9007199254740991,b="Maximum allowed length exceeded";a({target:"Array",proto:!0,forced:!u||!f},{splice:function(e,t){var n,a,l,m,u,f,v=c(this),S=r(v.length),k=o(e,S),C=arguments.length;if(0===C?n=a=0:1===C?(n=0,a=S-k):(n=C-2,a=h(p(i(t),0),S-k)),S+n-a>g)throw TypeError(b);for(l=d(v,a),m=0;m<a;m++)u=k+m,u in v&&s(l,m,v[u]);if(l.length=a,n<a){for(m=k;m<S-a;m++)u=m+a,f=m+n,u in v?v[f]=v[u]:delete v[f];for(m=S;m>S-a+n;m--)delete v[m-1]}else if(n>a)for(m=S-a;m>k;m--)u=m+a-1,f=m+n-1,u in v?v[f]=v[u]:delete v[f];for(m=0;m<n;m++)v[m+k]=arguments[m+2];return v.length=S-a+n,l}})},ab13:function(e,t,n){var a=n("b622"),o=a("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[o]=!1,"/./"[e](t)}catch(a){}}return!1}},bd97:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));n("7db0"),n("4160"),n("caad"),n("c975"),n("a15b"),n("a434"),n("b0c0"),n("2532"),n("159b");var a=n("e510");function o(e){var t=this;for(var n in t.peerconnection_config=null,t.sdp_constraints=null,t.remotePeerConnection=new Array,t.remoteDescriptionSet=new Array,t.iceCandidateList=new Array,t.webSocketAdaptor=null,t.roomName=null,t.videoTrackSender=null,t.audioTrackSender=null,t.playStreamId=new Array,t.micGainNode=null,t.localStream=null,t.isPlayMode=!1,t.debug=!1,t.camera_location="top",t.camera_margin=15,t.camera_percent=15,e)Object.prototype.hasOwnProperty.call(e,n)&&(this[n]=e[n]);if(t.localVideo=t.localVideoId,t.remoteVideo=t.remoteVideoId,!("WebSocket"in window))return Object(a["a"])("WebSocket not supported."),void t.callbackError("WebSocketNotSupported");if("undefined"==typeof navigator.mediaDevices&&0==t.isPlayMode)return Object(a["a"])("Cannot open camera and mic because of unsecure context. Please Install SSL(https)"),void t.callbackError("UnsecureContext");if(this.getUserMedia=function(e,n){navigator.mediaDevices.getUserMedia(e).then((function(a){var o=a.getAudioTracks();if(o.length>0&&a.removeTrack(o[0]),"undefined"!=e.video&&"undefined"!=typeof e.video.mandatory&&"undefined"!=typeof e.video.mandatory.chromeMediaSource&&"desktop"==e.video.mandatory.chromeMediaSource&&(a.getVideoTracks()[0].onended=function(){t.callback("screen_share_stopped")}),"undefined"!=n&&0!=n){var i={audio:n};navigator.mediaDevices.getUserMedia(i).then((function(e){"undefined"!=t.mediaConstraints&&"screen+camera"==t.mediaConstraints.video?navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then((function(n){var o=document.createElement("canvas"),i=o.getContext("2d"),r=document.createElement("video");r.srcObject=a,r.play();var c=document.createElement("video");c.srcObject=n,c.play();var d=o.captureStream(15);d.addTrack(e.getAudioTracks()[0]),t.gotStream(d),setInterval((function(){o.width=r.videoWidth,o.height=r.videoHeight,i.drawImage(r,0,0,o.width,o.height);var e,n=r.videoWidth*(t.camera_percent/100),a=c.videoHeight/c.videoWidth*n,d=o.width-n-t.camera_margin;e="top"==t.camera_location?t.camera_margin:o.height-a-t.camera_margin,i.drawImage(c,d,e,n,a)}),66)})).catch((function(e){t.callbackError(e.name,e.message)})):(a.addTrack(e.getAudioTracks()[0]),t.gotStream(a))})).catch((function(e){t.callbackError(e.name,e.message)}))}})).catch((function(e){t.callbackError(e.name,e.message)}))},this.openScreen=function(e){var n=function n(o){if("rtcmulticonnection-extension-loaded"==o.data)Object(a["a"])("rtcmulticonnection-extension-loaded parameter is received"),window.postMessage("get-sourceId","*");else if("PermissionDeniedError"==o.data)Object(a["a"])("Permission denied error"),t.callbackError("screen_share_permission_denied");else if(o.data&&o.data.sourceId){var i={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:o.data.sourceId},optional:[]}};t.getUserMedia(i,e),window.removeEventListener("message",n)}};window.addEventListener("message",n,!1),window.postMessage("are-you-there","*")},this.openStream=function(e){t.mediaConstraints=e;var n=!1;"undefined"!=typeof e.audio&&0!=e.audio&&(n=e.audio),"undefined"!=typeof e.video?"screen+camera"==e.video||"screen"==e.video?this.openScreen(n):t.getUserMedia(e,n):(Object(a["a"])("MediaConstraint video is not defined"),t.callbackError("media_constraint_video_not_defined"))},this.closeStream=function(){t.localStream.getTracks().forEach((function(e){"live"==e.readyState&&(e.onended=function(){return Object(a["a"])("ended",e)},e.stop())}))},this.checkExtension=function(){var e=function e(n){"rtcmulticonnection-extension-loaded"==n.data&&(t.callback("screen_share_extension_available"),window.removeEventListener("message",e))};window.addEventListener("message",e,!1),window.postMessage("are-you-there","*")},t.checkExtension(),this.isPlayMode||"undefined"==typeof t.mediaConstraints||null!=this.localStream)null!=t.webSocketAdaptor&&0!=t.webSocketAdaptor.isConnected()||(t.webSocketAdaptor=new i);else if("undefined"!=typeof t.mediaConstraints.video&&0!=t.mediaConstraints.video)t.mediaConstraints.audio.mandatory?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(e){navigator.mediaDevices.getUserMedia(t.mediaConstraints).then((function(n){var o=new AudioContext,i=o.createGain();i.gain.value=1;var r=o.createMediaStreamDestination(),c=o.createMediaStreamSource(n);c.connect(i),t.micGainNode=o.createGain(),t.micGainNode.gain.value=1;var d=o.createMediaStreamSource(e);d.connect(t.micGainNode),i.connect(r),t.micGainNode.connect(r),n.removeTrack(n.getAudioTracks()[0]),r.stream.getAudioTracks().forEach((function(e){n.addTrack(e)})),Object(a["a"])("Running gotStream"),t.gotStream(n)})).catch((function(e){t.callbackError(e.name,e.message)}))})).catch((function(e){t.callbackError(e.name,e.message)})):t.openStream(t.mediaConstraints,t.mode);else{var o={audio:t.mediaConstraints.audio};navigator.mediaDevices.getUserMedia(o).then((function(e){t.gotStream(e)})).catch((function(e){t.callbackError(e.name,e.message)}))}function i(){var e=new WebSocket(t.websocket_url),n=!1,o=-1,i=function(){-1!=o&&(t.debug&&Object(a["a"])("Clearing ping message timer"),clearInterval(o),o=-1)},r=function(){e.send;var t={command:"ping"};e.send(JSON.stringify(t))};this.close=function(){e.close()},e.onopen=function(){t.debug&&Object(a["a"])("websocket connected"),o=setInterval((function(){r()}),5e3),n=!0,t.callback("initialized")},this.send=function(n){0!=e.readyState&&2!=e.readyState&&3!=e.readyState?(e.send(n),Object(a["a"])("sent message:"+n)):t.callbackError("WebSocketNotConnected")},this.isConnected=function(){return n},e.onmessage=function(e){var n=JSON.parse(e.data);"start"==n.command?(t.debug&&Object(a["a"])("received start command"),t.startPublishing(n.streamId)):"takeCandidate"==n.command?(t.debug&&(Object(a["a"])("received ice candidate for stream id "+n.streamId),Object(a["a"])(n.candidate)),t.takeCandidate(n.streamId,n.label,n.candidate)):"takeConfiguration"==n.command?(t.debug&&Object(a["a"])("received remote description type for stream id: "+n.streamId+" type: "+n.type),t.takeConfiguration(n.streamId,n.sdp,n.type)):"stop"==n.command?(Object(a["a"])("Stop command received"),t.closePeerConnection(n.streamId)):"error"==n.command?t.callbackError(n.definition):"notification"==n.command?(t.callback(n.definition,n),"play_finished"!=n.definition&&"publish_finished"!=n.definition||t.closePeerConnection(n.streamId)):"streamInformation"==n.command?t.callback(n.command,n):"pong"==n.command&&t.callback(n.command)},e.onerror=function(e){Object(a["a"])(" error occured: "+JSON.stringify(e)),i(),t.callbackError(e)},e.onclose=function(e){n=!1,Object(a["a"])("connection closed."),i(),t.callback("closed",e)}}this.enableMicInMixedAudio=function(e){null!=t.micGainNode&&(t.micGainNode.gain.value=e?1:0)},this.publish=function(e,n){var a={command:"publish",streamId:e,token:n,video:t.localStream.getVideoTracks().length>0,audio:t.localStream.getAudioTracks().length>0};t.webSocketAdaptor.send(JSON.stringify(a))},this.joinRoom=function(e,n){t.roomName=e;var a={command:"joinRoom",room:e,streamId:n};t.webSocketAdaptor.send(JSON.stringify(a))},this.play=function(e,n,a){t.playStreamId.push(e);var o={command:"play",streamId:e,token:n,room:a};t.webSocketAdaptor.send(JSON.stringify(o))},this.stop=function(e){t.closePeerConnection(e);var n={command:"stop",streamId:e};t.webSocketAdaptor.send(JSON.stringify(n))},this.join=function(e){var n={command:"join",streamId:e};t.webSocketAdaptor.send(JSON.stringify(n))},this.leaveFromRoom=function(e){t.roomName=e;var n={command:"leaveFromRoom",room:e};Object(a["a"])("leave request is sent for "+e),t.webSocketAdaptor.send(JSON.stringify(n))},this.leave=function(e){var n={command:"leave",streamId:e};t.webSocketAdaptor.send(JSON.stringify(n)),t.closePeerConnection(e)},this.getStreamInfo=function(e){var t={command:"getStreamInfo",streamId:e};this.webSocketAdaptor.send(JSON.stringify(t))},this.gotStream=function(e){t.localStream=e,t.localVideo.srcObject=e,null!=t.webSocketAdaptor&&0!=t.webSocketAdaptor.isConnected()||(t.webSocketAdaptor=new i)},this.switchVideoCapture=function(e){var n={video:!0,audio:!1};t.switchVideoSource(e,n,null)},this.switchDesktopCapture=function(e){var n=function n(o){if("rtcmulticonnection-extension-loaded"==o.data)Object(a["a"])("rtcmulticonnection-extension-loaded parameter is received"),window.postMessage("get-sourceId","*");else if("PermissionDeniedError"==o.data)Object(a["a"])("Permission denied error"),t.callbackError("screen_share_permission_denied");else if(o.data&&o.data.sourceId){var i={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:o.data.sourceId},optional:[]}};t.switchVideoSource(e,i,(function(){t.callback("screen_share_stopped"),t.switchVideoCapture(e)})),window.removeEventListener("message",n)}};window.addEventListener("message",n,!1),window.postMessage("are-you-there","*")},t.arrangeStreams=function(e,n){var a=t.localStream.getVideoTracks()[0];t.localStream.removeTrack(a),a.stop(),t.localStream.addTrack(e.getVideoTracks()[0]),t.localVideo.srcObject=t.localStream,null!=n&&(e.getVideoTracks()[0].onended=function(e){n(e)})},this.switchVideoSource=function(e,n,o){navigator.mediaDevices.getUserMedia(n).then((function(n){if(null!=t.remotePeerConnection[e]){var i=t.remotePeerConnection[e].getSenders().find((function(e){return"video"==e.track.kind}));i.replaceTrack(n.getVideoTracks()[0]).then((function(){t.arrangeStreams(n,o)})).catch((function(e){Object(a["a"])(e.name)}))}else t.arrangeStreams(n,o)})).catch((function(e){t.callbackError(e.name)}))},this.onTrack=function(e,n){if(Object(a["a"])("onTrack"),null!=t.remoteVideo)t.remoteVideo.srcObject!==e.streams[0]&&(t.remoteVideo.srcObject=e.streams[0],Object(a["a"])("Received remote stream"));else{var o={track:e.streams[0],streamId:n};t.callback("newStreamAvailable",o)}},this.iceCandidateReceived=function(e,n){if(e.candidate){var o={command:"takeCandidate",streamId:n,label:e.candidate.sdpMLineIndex,id:e.candidate.sdpMid,candidate:e.candidate.candidate};t.debug&&(Object(a["a"])("sending ice candiate for stream Id "+n),Object(a["a"])(JSON.stringify(e.candidate))),t.webSocketAdaptor.send(JSON.stringify(o))}},this.initPeerConnection=function(e){if(null==t.remotePeerConnection[e]){var n=e;Object(a["a"])("stream id in init peer connection: "+e+" close dstream id: "+n),t.remotePeerConnection[e]=new RTCPeerConnection(t.peerconnection_config),t.remoteDescriptionSet[e]=!1,t.iceCandidateList[e]=new Array,t.playStreamId.includes(e)||t.remotePeerConnection[e].addStream(t.localStream),t.remotePeerConnection[e].onicecandidate=function(e){t.iceCandidateReceived(e,n)},t.remotePeerConnection[e].ontrack=function(e){t.onTrack(e,n)}}},this.closePeerConnection=function(e){if(null!=t.remotePeerConnection[e]&&"closed"!=t.remotePeerConnection[e].signalingState){t.remotePeerConnection[e].close(),t.remotePeerConnection[e]=null,delete t.remotePeerConnection[e];var n=t.playStreamId.indexOf(e);-1!=n&&t.playStreamId.splice(n,1)}},this.signallingState=function(e){return null!=t.remotePeerConnection[e]?t.remotePeerConnection[e].signalingState:null},this.iceConnectionState=function(e){return null!=t.remotePeerConnection[e]?t.remotePeerConnection[e].iceConnectionState:null},this.gotDescription=function(e,n){t.remotePeerConnection[n].setLocalDescription(e).then((function(){Object(a["a"])("Set local description successfully for stream Id "+n);var o={command:"takeConfiguration",streamId:n,type:e.type,sdp:e.sdp};t.debug&&(Object(a["a"])("local sdp: "),Object(a["a"])(e.sdp)),t.webSocketAdaptor.send(JSON.stringify(o))})).catch((function(e){Object(a["a"])("Cannot set local description. Error is: "+e)}))},this.turnOffLocalCamera=function(){if(null!=t.remotePeerConnection){var e=t.localStream.getVideoTracks()[0];e.enabled=!1}else this.callbackError("NoActiveConnection")},this.turnOnLocalCamera=function(){if(null!=t.remotePeerConnection){var e=t.localStream.getVideoTracks()[0];e.enabled=!0}else this.callbackError("NoActiveConnection")},this.muteLocalMic=function(){if(null!=t.remotePeerConnection){var e=t.localStream.getAudioTracks()[0];e.enabled=!1}else this.callbackError("NoActiveConnection")},this.unmuteLocalMic=function(){if(null!=t.remotePeerConnection){var e=t.localStream.getAudioTracks()[0];e.enabled=!0}else this.callbackError("NoActiveConnection")},this.takeConfiguration=function(e,n,o){var i=e,r=o,c=n;t.initPeerConnection(i),t.remotePeerConnection[i].setRemoteDescription(new RTCSessionDescription({sdp:c,type:r})).then((function(e){t.debug&&(Object(a["a"])("set remote description is succesfull with response: "+e+" for stream : "+i+" and type: "+r),Object(a["a"])(c)),t.remoteDescriptionSet[i]=!0;var n=t.iceCandidateList[i].length;Object(a["a"])("Ice candidate list size to be added: "+n);for(var o=0;o<n;o++)t.addIceCandidate(i,t.iceCandidateList[i][o]);t.iceCandidateList[i]=[],"offer"==r&&(Object(a["a"])("try to create answer for stream id: "+i),t.remotePeerConnection[i].createAnswer(t.sdp_constraints).then((function(e){Object(a["a"])("created answer for stream id: "+i),t.gotDescription(e,i)})).catch((function(e){Object(a["a"])("create answer error :"+e)})))})).catch((function(e){t.debug&&Object(a["a"])("set remote description is failed with error: "+e)}))},this.takeCandidate=function(e,n,o){var i=e,r=n,c=o,d=new RTCIceCandidate({sdpMLineIndex:r,candidate:c});t.initPeerConnection(i),1==t.remoteDescriptionSet[i]?t.addIceCandidate(i,d):(Object(a["a"])("Ice candidate is added to list because remote description is not set yet"),t.iceCandidateList[i].push(d))},this.addIceCandidate=function(e,n){t.remotePeerConnection[e].addIceCandidate(n).then((function(){t.debug&&Object(a["a"])("Candidate is added for stream "+e)})).catch((function(t){Object(a["a"])("ice candiate cannot be added for stream id: "+e+" error is: "+t),Object(a["a"])(n)}))},this.startPublishing=function(e){var n=e;t.initPeerConnection(n),t.remotePeerConnection[n].createOffer(t.sdp_constraints).then((function(e){t.gotDescription(e,n)})).catch((function(e){Object(a["a"])("create offer error for stream id: "+n+" error: "+e)}))},this.closeWebSocket=function(){for(var e in t.remotePeerConnection)t.remotePeerConnection[e].close();t.remotePeerConnection=new Array,t.webSocketAdaptor.close()}}},c975:function(e,t,n){"use strict";var a=n("23e7"),o=n("4d64").indexOf,i=n("a640"),r=n("ae40"),c=[].indexOf,d=!!c&&1/[1].indexOf(1,-0)<0,s=i("indexOf"),l=r("indexOf",{ACCESSORS:!0,1:0});a({target:"Array",proto:!0,forced:d||!s||!l},{indexOf:function(e){return d?c.apply(this,arguments)||0:o(this,e,arguments.length>1?arguments[1]:void 0)}})},caad:function(e,t,n){"use strict";var a=n("23e7"),o=n("4d64").includes,i=n("44d2"),r=n("ae40"),c=r("indexOf",{ACCESSORS:!0,1:0});a({target:"Array",proto:!0,forced:!c},{includes:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}}),i("includes")}}]);
//# sourceMappingURL=SupplyStream~ViewStream.ea63c276.js.map