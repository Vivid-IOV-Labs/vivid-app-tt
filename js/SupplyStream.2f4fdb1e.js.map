{"version":3,"sources":["webpack:///./src/pages/SupplyStream.vue?bee1","webpack:///src/pages/SupplyStream.vue","webpack:///./src/pages/SupplyStream.vue?251a","webpack:///./src/pages/SupplyStream.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","attrs","staticClass","_v","_s","currentTime","ref","videoOptions","on","updateLiveTime","stop_publish_button","disabled","_e","$event","endStream","Ok","closeVideoStream","streamReported","Cancel","staticRenderFns","io","sails","url","env","name","components","BaseVideo","data","player","autoplay","muted","liveui","fill","controls","streamNameBox","$store","state","requests","selectedPin","openLocationCode","streamId","webRTCAdaptor","methods","stopPublishing","closeStream","closePeerConnection","closeWebSocket","$router","push","startPublishing","publish","stop","mounted","socket","$refs","videoplayer","video","OfferToReceiveAudio","OfferToReceiveVideo","audio","websocket_url","mediaConstraints","peerconnection_config","pc_config","sdp_constraints","sdpConstraints","localVideoId","debug","callback","info","description","callbackError","errorMessage","JSON","stringify","error","message","indexOf","alert","component"],"mappings":"uHAAA,ICgEA,EDhEIA,EAAS,WAAa,IAAIC,EAAIC,KAASC,EAAGF,EAAIG,eAAmBC,EAAGJ,EAAIK,MAAMD,IAAIF,EAAG,OAAOE,EAAG,aAAa,CAACE,MAAM,CAAC,GAAK,aAAa,CAACF,EAAG,MAAM,CAACG,YAAY,qBAAqB,CAACH,EAAG,MAAM,CAACG,YAAY,0CAA0C,CAACH,EAAG,eAAe,CAACG,YAAY,oDAAoD,CAACH,EAAG,YAAY,CAACG,YAAY,YAAYD,MAAM,CAAC,KAAO,UAAUF,EAAG,OAAO,CAACG,YAAY,QAAQ,CAACP,EAAIQ,GAAG,UAAU,GAAGJ,EAAG,eAAe,CAACG,YAAY,4DAA4D,CAACH,EAAG,YAAY,CAACG,YAAY,YAAYD,MAAM,CAAC,KAAO,WAAWF,EAAG,OAAO,CAACG,YAAY,QAAQ,CAACP,EAAIQ,GAAGR,EAAIS,GAAGT,EAAIU,iBAAiB,IAAI,GAAGN,EAAG,aAAa,CAACO,IAAI,cAAcL,MAAM,CAAC,QAAUN,EAAIY,cAAcC,GAAG,CAAC,WAAab,EAAIc,kBAAkBV,EAAG,MAAM,CAACG,YAAY,6CAA6C,CAAGP,EAAIe,oBAAoBC,SAAwQhB,EAAIiB,KAAlQb,EAAG,eAAe,CAACG,YAAY,wCAAwCD,MAAM,CAAC,GAAK,uBAAuBO,GAAG,CAAC,MAAQ,SAASK,GAAQlB,EAAImB,WAAY,KAAQ,CAACnB,EAAIQ,GAAG,kBAAkBJ,EAAG,YAAY,CAACG,YAAY,YAAYD,MAAM,CAAC,KAAO,YAAY,IAAa,GAAGF,EAAG,qBAAqB,CAACE,MAAM,CAAC,SAAW,YAAY,MAAQ,uBAAuB,OAAS,CAC9tCc,GAAIpB,EAAIqB,kBACR,QAAUrB,EAAIsB,gBAAgBT,GAAG,CAAC,iBAAiB,SAASK,GAAQlB,EAAIsB,eAAeJ,KAAU,CAAClB,EAAIQ,GAAG,6DAA6DJ,EAAG,qBAAqB,CAACE,MAAM,CAAC,SAAW,YAAY,MAAQ,kBAAkB,OAAS,CAChQc,GAAIpB,EAAIqB,iBACRE,OAAQ,WAAc,OAAQvB,EAAImB,WAAY,IAC9C,QAAUnB,EAAImB,WAAWN,GAAG,CAAC,iBAAiB,SAASK,GAAQlB,EAAImB,UAAUD,KAAU,CAAClB,EAAIQ,GAAG,sDAAsD,MACzJgB,EAAkB,G,sGC4DlB,EAAJ,QACEC,EAAK,EAAP,GAEEA,EAAK,IAAP,KACEA,EAAGC,MAAMC,IAAMC,EAAjB,sBAoBA,OACEC,KAAM,eACNC,WAAY,CACVC,UAAJ,QAEEC,KALF,WAMI,MAAO,CACLC,OAAQ,KACRrB,aAAc,CACZsB,UAAU,EACVC,OAAO,EACPC,QAAQ,EACRC,MAAM,EACNC,UAAU,GAEZ5B,YAAa,WACbK,oBAAqB,CACnBC,UAAU,GAEZuB,cAAetC,KAAKuC,OAAOC,MAAMC,SAASC,YAAYC,iBACtDC,SAAU,GACVC,cAAe,GACfxB,gBAAgB,EAChBH,WAAW,EACXyB,iBAAkB,KAGtBG,QAAS,CACP1B,iBADJ,WAEMpB,KAAK+C,iBACL/C,KAAK6C,cAAcG,cACnBhD,KAAK6C,cAAcI,sBACnBjD,KAAK6C,cAAcK,iBACnBlD,KAAKmD,QAAQC,KAAK,CAAxB,eAEIC,gBARJ,WASMrD,KAAK4C,SAAW5C,KAAKsC,cACrBtC,KAAK6C,cAAcS,QAAQtD,KAAK4C,SAAU,6BAE5CG,eAZJ,WAaM/C,KAAK6C,cAAcU,KAAKvD,KAAK4C,WAE/B/B,eAfJ,SAeA,GACMb,KAAKS,YAAcA,IAGvB+C,QA9CF,WA8CA,WACIhC,EAAGiC,OAAO7C,GAAG,iCAAiC,SAAlD,gBACM,EAAN,oCACM,EAAN,qBAEIZ,KAAKgC,OAAShC,KAAK0D,MAAMC,YAAYD,MAAME,MAC3C,IAAJ,OAEA,GACMC,qBAAqB,EACrBC,qBAAqB,GAG3B,GACMF,OAAO,EACPG,OAAO,GAET/D,KAAK6C,cAAgB,IAAI,EAA7B,MACMmB,cAAe,0DACfC,iBAAkBA,EAClBC,sBAAuBC,EACvBC,gBAAiBC,EACjBC,aAActE,KAAKgC,OACnBuC,OAAO,EACPC,SAAU,SAAhB,KACoB,eAARC,GACF,OAAV,OAAU,CAAV,eACU,EAAV,gCACU,EAAV,mBACA,sBAEU,OAAV,OAAU,CAAV,mBACU,EAAV,iCAEA,uBAEU,OAAV,OAAU,CAAV,oBACU,EAAV,iCACA,wCAIA,0BACU,OAAV,OAAU,CAAV,wBACA,cACU,OAAV,OAAU,CAAV,qBACoC,oBAAfC,GACT,OAAZ,OAAY,CAAZ,2CAOMC,cAAe,SAArB,KAGQ,OAAR,OAAQ,CAAR,sCACQ,IAAIC,EAAeC,KAAKC,UAAUC,GACZ,oBAAXC,IACTJ,EAAeI,IAGsB,GAAnCD,EAAME,QAAQ,iBAChBL,EACV,8DAEA,mCACA,gCAEUA,EACV,uGAEA,uCACA,4CAEUA,EACV,oHAEA,kCACA,sCAEUA,EAAe,iDACzB,0BACUA,EAAe,4BACzB,gCACUA,EACV,0HACA,wCACUA,EAAe,wDAGjBM,MAAMN,QCpOwU,I,YCOlVO,EAAY,eACd,EACArF,EACAyB,GACA,EACA,KACA,KACA,MAIa,aAAA4D,E","file":"js/SupplyStream.2f4fdb1e.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('v-ons-page',{attrs:{\"id\":\"Streamer\"}},[_c('div',{staticClass:\"stream__container\"},[_c('div',{staticClass:\"stream__controls stream__controls--top\"},[_c('v-ons-button',{staticClass:\"btn btn--small btn--opacity-soft  flex-center-xy\"},[_c('base-icon',{staticClass:\"btn__icon\",attrs:{\"name\":\"user\"}}),_c('span',{staticClass:\"ml-2\"},[_vm._v(\"101\")])],1),_c('v-ons-button',{staticClass:\"btn btn--small btn--opacity-soft ml-auto  flex-center-xy\"},[_c('base-icon',{staticClass:\"btn__icon\",attrs:{\"name\":\"clock\"}}),_c('span',{staticClass:\"ml-2\"},[_vm._v(_vm._s(_vm.currentTime))])],1)],1),_c('base-video',{ref:\"videoplayer\",attrs:{\"options\":_vm.videoOptions},on:{\"timeupdate\":_vm.updateLiveTime}}),_c('div',{staticClass:\"stream__controls stream__controls--bottom\"},[(!_vm.stop_publish_button.disabled)?_c('v-ons-button',{staticClass:\"btn btn--opacity-soft btn--full-width\",attrs:{\"id\":\"stop_publish_button\"},on:{\"click\":function($event){_vm.endStream = true}}},[_vm._v(\"End Streaming \"),_c('base-icon',{staticClass:\"btn__icon\",attrs:{\"name\":\"pause\"}})],1):_vm._e()],1),_c('v-ons-alert-dialog',{attrs:{\"modifier\":\"rowfooter\",\"title\":'Live stream reported',\"footer\":{\n        Ok: _vm.closeVideoStream\n      },\"visible\":_vm.streamReported},on:{\"update:visible\":function($event){_vm.streamReported=$event}}},[_vm._v(\" This Live stream has been reported and therefor ended \")]),_c('v-ons-alert-dialog',{attrs:{\"modifier\":\"rowfooter\",\"title\":'End live stream',\"footer\":{\n        Ok: _vm.closeVideoStream,\n        Cancel: function () { return (_vm.endStream = false); }\n      },\"visible\":_vm.endStream},on:{\"update:visible\":function($event){_vm.endStream=$event}}},[_vm._v(\" Are you sure you want to end this live stream \")])],1)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <v-ons-page id=\"Streamer\">\n    <div class=\"stream__container\">\n      <div class=\"stream__controls stream__controls--top\">\n        <v-ons-button class=\"btn btn--small btn--opacity-soft  flex-center-xy\">\n          <base-icon class=\"btn__icon\" name=\"user\"></base-icon>\n          <span class=\"ml-2\">101</span>\n        </v-ons-button>\n\n        <v-ons-button\n          class=\"btn btn--small btn--opacity-soft ml-auto  flex-center-xy\"\n        >\n          <base-icon class=\"btn__icon\" name=\"clock\"></base-icon>\n          <span class=\"ml-2\">{{ currentTime }}</span>\n        </v-ons-button>\n      </div>\n      <base-video\n        ref=\"videoplayer\"\n        @timeupdate=\"updateLiveTime\"\n        :options=\"videoOptions\"\n      ></base-video>\n\n      <div class=\"stream__controls stream__controls--bottom\">\n        <v-ons-button\n          @click=\"endStream = true\"\n          class=\"btn btn--opacity-soft btn--full-width\"\n          v-if=\"!stop_publish_button.disabled\"\n          id=\"stop_publish_button\"\n          >End Streaming <base-icon class=\"btn__icon\" name=\"pause\"></base-icon\n        ></v-ons-button>\n      </div>\n      <v-ons-alert-dialog\n        modifier=\"rowfooter\"\n        :title=\"'Live stream reported'\"\n        :footer=\"{\n          Ok: closeVideoStream\n        }\"\n        :visible.sync=\"streamReported\"\n      >\n        This Live stream has been reported and therefor ended\n      </v-ons-alert-dialog>\n      <v-ons-alert-dialog\n        modifier=\"rowfooter\"\n        :title=\"'End live stream'\"\n        :footer=\"{\n          Ok: closeVideoStream,\n          Cancel: () => (endStream = false)\n        }\"\n        :visible.sync=\"endStream\"\n      >\n        Are you sure you want to end this live stream\n      </v-ons-alert-dialog>\n    </div>\n  </v-ons-page>\n</template>\n\n<script>\nimport BaseVideo from \"@/components/BaseVideo.vue\";\n\nimport { WebRTCAdaptor } from \"@/util/webrtc_adaptor.js\";\nimport socketIOClient from \"socket.io-client\";\nimport sailsIOClient from \"sails.io.js\";\n\nimport env from \"@/env.js\";\nlet io;\n\nif (socketIOClient.sails) {\n  io = socketIOClient;\n} else {\n  io = sailsIOClient(socketIOClient);\n  io.sails.url = env.web_service_url;\n}\nimport devLog from \"@/util/devlog.js\";\n/*\nconst getDevices = async () => {\n  const devices = await window.navigator.mediaDevices.enumerateDevices();\n  return devices;\n};\nconst getStream = async()=>{\n  const stream = await window.navigator.mediaDevices.getUserMedia(\n  {\n    video: true,\n    audio: true,\n  });\n  return stream;\n}\nstream.getAudioTracks();\nstream.getVideoTracks();\n\n*/\nexport default {\n  name: \"supplyStream\",\n  components: {\n    BaseVideo\n  },\n  data() {\n    return {\n      player: null,\n      videoOptions: {\n        autoplay: true,\n        muted: true,\n        liveui: true,\n        fill: true,\n        controls: false\n      },\n      currentTime: \"00:00:00\",\n      stop_publish_button: {\n        disabled: true\n      },\n      streamNameBox: this.$store.state.requests.selectedPin.openLocationCode,\n      streamId: \"\",\n      webRTCAdaptor: \"\",\n      streamReported: false,\n      endStream: false,\n      openLocationCode: \"\"\n    };\n  },\n  methods: {\n    closeVideoStream() {\n      this.stopPublishing();\n      this.webRTCAdaptor.closeStream();\n      this.webRTCAdaptor.closePeerConnection();\n      this.webRTCAdaptor.closeWebSocket();\n      this.$router.push({ path: \"home\" });\n    },\n    startPublishing() {\n      this.streamId = this.streamNameBox;\n      this.webRTCAdaptor.publish(this.streamId, \"287084795627827033631286\");\n    },\n    stopPublishing() {\n      this.webRTCAdaptor.stop(this.streamId);\n    },\n    updateLiveTime(currentTime) {\n      this.currentTime = currentTime;\n    }\n  },\n  mounted() {\n    io.socket.on(\"request-deleted-flag-reported\", ({ data }) => {\n      this.openLocationCode = data.openLocationCode;\n      this.streamReported = true;\n    });\n    this.player = this.$refs.videoplayer.$refs.video;\n    const pc_config = null;\n\n    const sdpConstraints = {\n      OfferToReceiveAudio: false,\n      OfferToReceiveVideo: false\n    };\n\n    const mediaConstraints = {\n      video: true,\n      audio: true\n    };\n    this.webRTCAdaptor = new WebRTCAdaptor({\n      websocket_url: \"wss://streams.vividiov.media:5443/WebRTCAppEE/websocket\",\n      mediaConstraints: mediaConstraints,\n      peerconnection_config: pc_config,\n      sdp_constraints: sdpConstraints,\n      localVideoId: this.player,\n      debug: process.env.NODE_ENV != \"production\",\n      callback: (info, description) => {\n        if (info == \"initialized\") {\n          devLog(\"initialized\");\n          this.stop_publish_button.disabled = true;\n          this.startPublishing();\n        } else if (info == \"publish_started\") {\n          //stream is being published\n          devLog(\"publish started\");\n          this.stop_publish_button.disabled = false;\n          //this.startAnimation();\n        } else if (info == \"publish_finished\") {\n          //stream is being finished\n          devLog(\"publish finished\");\n          this.stop_publish_button.disabled = true;\n        } else if (info == \"screen_share_extension_available\") {\n          //this.screen_share_checkbox.disabled = false;\n          //devLog(\"screen share extension available\");\n          //this.install_extension_link.style.display = \"none\";\n        } else if (info == \"screen_share_stopped\") {\n          devLog(\"screen share stopped\");\n        } else if (info == \"closed\") {\n          devLog(\"Connection closed\");\n          if (typeof description != \"undefined\") {\n            devLog(\"Connecton closed: \" + JSON.stringify(description));\n          }\n        } else if (info == \"pong\") {\n          //ping/pong message are sent to and received from server to make the connection alive all the time\n          //It's especially useful when load balancer or firewalls close the websocket connection due to inactivity\n        }\n      },\n      callbackError: (error, message) => {\n        //some of the possible errors, NotFoundError, SecurityError,PermissionDeniedError\n\n        devLog(\"error callback: \" + JSON.stringify(error));\n        var errorMessage = JSON.stringify(error);\n        if (typeof message != \"undefined\") {\n          errorMessage = message;\n        }\n        //var errorMessage = JSON.stringify(error);\n        if (error.indexOf(\"NotFoundError\") != -1) {\n          errorMessage =\n            \"Camera or Mic are not found or not allowed in your device.\";\n        } else if (\n          error.indexOf(\"NotReadableError\") != -1 ||\n          error.indexOf(\"TrackStartError\") != -1\n        ) {\n          errorMessage =\n            \"Camera or Mic is being used by some other process that does not not allow these devices to be read.\";\n        } else if (\n          error.indexOf(\"OverconstrainedError\") != -1 ||\n          error.indexOf(\"ConstraintNotSatisfiedError\") != -1\n        ) {\n          errorMessage =\n            \"There is no device found that fits your video and audio constraints. You may change video and audio constraints.\";\n        } else if (\n          error.indexOf(\"NotAllowedError\") != -1 ||\n          error.indexOf(\"PermissionDeniedError\") != -1\n        ) {\n          errorMessage = \"You are not allowed to access camera and mic.\";\n        } else if (error.indexOf(\"TypeError\") != -1) {\n          errorMessage = \"Video/Audio is required.\";\n        } else if (error.indexOf(\"UnsecureContext\") != -1) {\n          errorMessage =\n            \"Fatal Error: Browser cannot access camera and mic because of unsecure context. Please install SSL and access via https\";\n        } else if (error.indexOf(\"WebSocketNotSupported\") != -1) {\n          errorMessage = \"Fatal Error: WebSocket not supported in this browser\";\n        }\n\n        alert(errorMessage);\n      }\n    });\n  }\n};\n</script>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./SupplyStream.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./SupplyStream.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./SupplyStream.vue?vue&type=template&id=d476c25c&\"\nimport script from \"./SupplyStream.vue?vue&type=script&lang=js&\"\nexport * from \"./SupplyStream.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}